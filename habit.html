<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Quest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .task-list-container {
            height: calc(100vh - 320px); /* Adjust based on other elements' heights */
        }
        /* Custom scrollbar for a more game-like feel */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* dark-gray */
        }
        ::-webkit-scrollbar-thumb {
            background: #4f46e5; /* indigo-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6366f1; /* indigo-500 */
        }
    </style>
</head>
<body class="bg-gray-900 text-white antialiased">

    <div id="app" class="min-h-screen flex flex-col items-center p-4 sm:p-6 md:p-8">
        
        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-4xl md:text-5xl font-bold text-indigo-400 tracking-wider">Habit Quest</h1>
            <p class="text-gray-400">Level up your life, one habit at a time.</p>
        </header>

        <!-- Player Stats -->
        <div class="w-full max-w-2xl bg-gray-800 rounded-lg shadow-lg p-4 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">Hero Stats</h2>
                <span id="player-level" class="px-3 py-1 bg-indigo-600 rounded-full text-sm font-bold">LVL 1</span>
            </div>
            <!-- HP Bar -->
            <div class="mb-3">
                <div class="flex justify-between mb-1">
                    <span class="text-sm font-semibold text-red-400">HP</span>
                    <span id="hp-stats" class="text-sm font-mono">50 / 50</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                    <div id="hp-bar" class="bg-red-500 h-4 rounded-full transition-all duration-500 ease-in-out" style="width: 100%;"></div>
                </div>
            </div>
            <!-- XP Bar -->
            <div>
                <div class="flex justify-between mb-1">
                    <span class="text-sm font-semibold text-green-400">XP</span>
                    <span id="xp-stats" class="text-sm font-mono">0 / 15</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                    <div id="xp-bar" class="bg-green-500 h-4 rounded-full transition-all duration-500 ease-in-out" style="width: 0%;"></div>
                </div>
            </div>
        </div>

        <!-- Add Task Form -->
        <div class="w-full max-w-2xl mb-6">
            <form id="add-task-form" class="flex gap-2">
                <input type="text" id="task-input" placeholder="Enter a new daily quest..." class="flex-grow bg-gray-700 border-2 border-gray-600 rounded-lg px-4 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">Add Quest</button>
            </form>
        </div>

        <!-- Task List -->
        <main class="w-full max-w-2xl bg-gray-800 rounded-lg shadow-lg p-4">
            <h3 class="text-lg font-semibold mb-4 border-b-2 border-gray-700 pb-2">Active Quests</h3>
            <div id="task-list-container" class="task-list-container overflow-y-auto pr-2">
                <!-- Tasks will be dynamically inserted here -->
                <div id="task-list"></div>
                <p id="empty-state" class="text-center text-gray-500 py-8 hidden">Your quest log is empty.<br>Add a quest to begin your adventure!</p>
            </div>
        </main>
        
    </div>
    
    <!-- Modal for notifications -->
    <div id="notification-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-gray-800 border-2 border-indigo-500 rounded-lg shadow-2xl p-8 text-center max-w-sm mx-auto">
            <h2 id="modal-title" class="text-3xl font-bold text-yellow-300 mb-4"></h2>
            <p id="modal-message" class="text-gray-300 mb-6"></p>
            <button id="modal-close-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg">Continue</button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const app = {
                // UI Elements
                elements: {
                    playerLevel: document.getElementById('player-level'),
                    hpStats: document.getElementById('hp-stats'),
                    hpBar: document.getElementById('hp-bar'),
                    xpStats: document.getElementById('xp-stats'),
                    xpBar: document.getElementById('xp-bar'),
                    addTaskForm: document.getElementById('add-task-form'),
                    taskInput: document.getElementById('task-input'),
                    taskList: document.getElementById('task-list'),
                    emptyState: document.getElementById('empty-state'),
                    modal: document.getElementById('notification-modal'),
                    modalTitle: document.getElementById('modal-title'),
                    modalMessage: document.getElementById('modal-message'),
                    modalCloseBtn: document.getElementById('modal-close-btn'),
                },

                // Game State
                state: {
                    level: 1,
                    hp: 50,
                    maxHp: 50,
                    xp: 0,
                    maxXp: 15,
                    tasks: []
                },
                
                // Initialization
                init() {
                    this.loadState();
                    this.addEventListeners();
                    this.render();
                },
                
                // Event Listeners
                addEventListeners() {
                    this.elements.addTaskForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.addTask();
                    });

                    this.elements.taskList.addEventListener('click', (e) => {
                        const button = e.target.closest('button');
                        if (!button) return;

                        const action = button.dataset.action;
                        const id = button.dataset.id;
                        
                        if (action === 'complete') this.completeTask(id);
                        if (action === 'fail') this.failTask(id);
                        if (action === 'delete') this.deleteTask(id);
                    });

                    this.elements.modalCloseBtn.addEventListener('click', () => {
                        this.elements.modal.classList.add('hidden');
                    });
                },
                
                // State Persistence
                saveState() {
                    localStorage.setItem('habitQuestState', JSON.stringify(this.state));
                },
                
                loadState() {
                    const savedState = localStorage.getItem('habitQuestState');
                    if (savedState) {
                        this.state = JSON.parse(savedState);
                    }
                },
                
                // Core Logic
                addTask() {
                    const text = this.elements.taskInput.value.trim();
                    if (text === '') return;
                    
                    const newTask = {
                        id: Date.now().toString(),
                        text: text,
                    };
                    
                    this.state.tasks.push(newTask);
                    this.elements.taskInput.value = '';
                    this.render();
                },

                completeTask(id) {
                    this.state.xp += 10;
                    if (this.state.xp >= this.state.maxXp) {
                        this.levelUp();
                    }
                    this.render();
                },

                failTask(id) {
                    this.state.hp = Math.max(0, this.state.hp - 5);
                    if (this.state.hp === 0) {
                        this.showNotification("Defeated!", "You've run out of HP. Complete quests to level up and restore your health.");
                    }
                    this.render();
                },

                deleteTask(id) {
                    this.state.tasks = this.state.tasks.filter(task => task.id !== id);
                    this.render();
                },

                levelUp() {
                    this.state.level++;
                    this.state.xp -= this.state.maxXp; // Carry over extra XP
                    this.state.maxXp = Math.floor(this.state.maxXp * 1.5);
                    this.state.maxHp += 10;
                    this.state.hp = this.state.maxHp; // Full heal
                    this.showNotification("Level Up!", `Congratulations! You've reached level ${this.state.level}. Your HP has been fully restored.`);
                },

                showNotification(title, message) {
                    this.elements.modalTitle.textContent = title;
                    this.elements.modalMessage.textContent = message;
                    this.elements.modal.classList.remove('hidden');
                },
                
                // Render function to update UI
                render() {
                    // Update stats
                    this.elements.playerLevel.textContent = `LVL ${this.state.level}`;
                    this.elements.hpStats.textContent = `${this.state.hp} / ${this.state.maxHp}`;
                    this.elements.xpStats.textContent = `${this.state.xp} / ${this.state.maxXp}`;
                    
                    // Update progress bars
                    const hpPercent = (this.state.hp / this.state.maxHp) * 100;
                    const xpPercent = (this.state.xp / this.state.maxXp) * 100;
                    this.elements.hpBar.style.width = `${hpPercent}%`;
                    this.elements.xpBar.style.width = `${xpPercent}%`;

                    // Update task list
                    this.elements.taskList.innerHTML = '';
                    if (this.state.tasks.length === 0) {
                        this.elements.emptyState.classList.remove('hidden');
                    } else {
                        this.elements.emptyState.classList.add('hidden');
                        this.state.tasks.forEach(task => {
                            const taskElement = document.createElement('div');
                            taskElement.className = 'flex items-center bg-gray-700 p-3 rounded-lg mb-2 animate-fade-in';
                            taskElement.innerHTML = `
                                <p class="flex-grow text-gray-300">${task.text}</p>
                                <div class="flex items-center gap-1">
                                    <button data-action="complete" data-id="${task.id}" class="w-9 h-9 flex items-center justify-center bg-green-600 hover:bg-green-700 rounded-md transition-transform transform hover:scale-110" title="Complete Quest (+10 XP)">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                                    </button>
                                    <button data-action="fail" data-id="${task.id}" class="w-9 h-9 flex items-center justify-center bg-red-600 hover:bg-red-700 rounded-md transition-transform transform hover:scale-110" title="Fail Quest (-5 HP)">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z" clip-rule="evenodd" /></svg>
                                    </button>
                                    <button data-action="delete" data-id="${task.id}" class="w-9 h-9 flex items-center justify-center bg-gray-600 hover:bg-gray-500 rounded-md transition-transform transform hover:scale-110" title="Abandon Quest">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                                    </button>
                                </div>
                            `;
                            this.elements.taskList.appendChild(taskElement);
                        });
                    }

                    // Save state after every render
                    this.saveState();
                }
            };
            
            // Start the application
            app.init();
        });
    </script>
</body>
</html>
